<?php
$countryCallingCodes = array
(
        '+1'=>'USA',
        93 => "Afghanistan",
        355 => "Albania",
        213 => "Algeria",
        376 => "Andorra",
        244 => "Angola",
        54 => "Argentina",
        374 => "Armenia",
        297 => "Aruba",
        247 => "Ascension",
        61 => "Australia",
        43 => "Austria",
        994 => "Azerbaijan",
        973 => "Bahrain",
        880 => "Bangladesh",
        375 => "Belarus",
        32 => "Belgium",
        501 => "Belize",
        229 => "Benin",
        '++1' => "Bermuda",
        975 => "Bhutan",
        591 => "Bolivia",
        387 => "Bosnia and Herzegovina",
        267 => "Botswana",
        55 => "Brazil",
        '+++1' => "British Virgin Islands",
        673 => "Brunei",
        359 => "Bulgaria",
        226 => "Burkina Faso",
        257 => "Burundi",
        855 => "Cambodia",
        237 => "Cameroon",
        '++++1' => "Canada",
        238 => "Cape Verde",
        '+++++1' => "Cayman Islands",
        236 => "Central African Republic",
        235 => "Chad",
        56 => "Chile",
        86 => "China",
        57 => "Colombia",
        269 => "Comoros",
        242 => "Congo",
        682 => "Cook Islands",
        506 => "Costa Rica",
        385 => "Croatia",
        53 => "Cuba",
        357 => "Cyprus",
        420 => "Czech Republic",
        243 => "Democratic Republic of Congo",
        45 => "Denmark",
        246 => "Diego Garcia",
        253 => "Djibouti",
        '++++++1' => "Dominica",
        '+++++++1' => "Dominican Republic",
        670 => "East Timor",
        593 => "Ecuador",
        20 => "Egypt",
        503 => "El Salvador",
        240 => "Equatorial Guinea",
        291 => "Eritrea",
        372 => "Estonia",
        251 => "Ethiopia",
        500 => "Falkland (Malvinas) Islands",
        298 => "Faroe Islands",
        679 => "Fiji",
        358 => "Finland",
        33 => "France",
        594 => "French Guiana",
        689 => "French Polynesia",
        241 => "Gabon",
        220 => "Gambia",
        995 => "Georgia",
        49 => "Germany",
        233 => "Ghana",
        350 => "Gibraltar",
        30 => "Greece",
        299 => "Greenland",
        '++++++++1' => "Grenada",
        590 => "Guadeloupe",
        '+++++++++1' => "Guam",
        502 => "Guatemala",
        224 => "Guinea",
        245 => "Guinea-Bissau",
        592 => "Guyana",
        509 => "Haiti",
        504 => "Honduras",
        852 => "Hong Kong",
        36 => "Hungary",
        354 => "Iceland",
        91 => "India",
        62 => "Indonesia",
        870  => "Inmarsat Satellite",
        98 => "Iran",
        964 => "Iraq",
        353 => "Ireland",
        972 => "Israel",
        39 => "Italy",
        225 => "Ivory Coast",
        '+++++++++++1' => "Jamaica",
        81 => "Japan",
        962 => "Jordan",
        7 => "Kazakhstan",
        254 => "Kenya",
        686 => "Kiribati",
        965 => "Kuwait",
        996 => "Kyrgyzstan",
        856 => "Laos",
        371 => "Latvia",
        961 => "Lebanon",
        266 => "Lesotho",
        231 => "Liberia",
        218 => "Libya",
        423 => "Liechtenstein",
        370 => "Lithuania",
        352 => "Luxembourg",
        853 => "Macau",
        389 => "Macedonia",
        261 => "Madagascar",
        265 => "Malawi",
        60 => "Malaysia",
        960 => "Maldives",
        223 => "Mali",
        356 => "Malta",
        692 => "Marshall Islands",
        596 => "Martinique",
        222 => "Mauritania",
        230 => "Mauritius",
        262 => "Mayotte",
        52 => "Mexico",
        691 => "Micronesia",
        373 => "Moldova",
        377 => "Monaco",
        976 => "Mongolia",
        382 => "Montenegro",
        "++++++++++++1" => "Montserrat",
        212 => "Morocco",
        258 => "Mozambique",
        95 => "Myanmar",
        264 => "Namibia",
        674 => "Nauru",
        977 => "Nepal",
        31 => "Netherlands",
        599 => "Netherlands Antilles",
        687 => "New Caledonia",
        64 => "New Zealand",
        505 => "Nicaragua",
        227 => "Niger",
        234 => "Nigeria",
        683 => "Niue Island",
        850 => "North Korea",
        "+++++++++++++1" => "Northern Marianas",
        47 => "Norway",
        968 => "Oman",
        92 => "Pakistan",
        680 => "Palau",
        507 => "Panama",
        675 => "Papua New Guinea",
        595 => "Paraguay",
        51 => "Peru",
        63 => "Philippines",
        48 => "Poland",
        351 => "Portugal",
        '-1' => "Puerto Rico",
        974 => "Qatar",
        262 => "Reunion",
        40 => "Romania",
        7 => "Russian Federation",
        250 => "Rwanda",
        290 => "Saint Helena",
        '--1' => "Saint Kitts and Nevis",
        '---1' => "Saint Lucia",
        508 => "Saint Pierre and Miquelon",
        '----1' => "Saint Vincent and the Grenadines",
        685 => "Samoa",
        378 => "San Marino",
        239 => "Sao Tome and Principe",
        966 => "Saudi Arabia",
        221 => "Senegal",
        381 => "Serbia",
        248 => "Seychelles",
        232 => "Sierra Leone",
        65 => "Singapore",
        421 => "Slovakia",
        386 => "Slovenia",
        677 => "Solomon Islands",
        252 => "Somalia",
        27 => "South Africa",
        82 => "South Korea",
        34 => "Spain",
        94 => "Sri Lanka",
        249 => "Sudan",
        597 => "Suriname",
        268 => "Swaziland",
        46 => "Sweden",
        41 => "Switzerland",
        963 => "Syria",
        886 => "Taiwan",
        992 => "Tajikistan",
        255 => "Tanzania",
        66 => "Thailand",
        228 => "Togo",
        690 => "Tokelau",
        '----1' => "Trinidad and Tobago",
        216 => "Tunisia",
        90 => "Turkey",
        993 => "Turkmenistan",
        '------1' => "Turks and Caicos Islands",
        688 => "Tuvalu",
        256 => "Uganda",
        380 => "Ukraine",
        971 => "United Arab Emirates",
        44 => "United Kingdom",
        '-------1' => "United States of America",
        '--------1' => "U.S. Virgin Islands",
        598 => "Uruguay",
        998 => "Uzbekistan",
        678 => "Vanuatu",
        379 => "Vatican City",
        58 => "Venezuela",
        84 => "Vietnam",
        681 => "Wallis and Futuna",
        967 => "Yemen",
        260 => "Zambia",
        263 => "Zimbabwe"
);
?>

<div aria-hidden="true" aria-expanded="false" style="display: none;" role="tabpanel"
     class="ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-14"
     id="tab_personal">
    <fieldset id="fieldset_s3" class="orderform-step clearfix">
        <!--
           <div class="formtitle">Please insert your personal information in the fields below and pass on to check out. Further on you will be redirected to PayPal or Moneybookers site.</div>
                <div class="total-price-sum  total_price total_price_box">
           -->
        @if(!@$get_data['partial'])
        <div class="total-price" id="box_total_price">
            <div class="total_price_container">
                <h3 class="total-price-header light">Grand total price:</h3>
                <input type="hidden" name="total_price" class="total_price_box">
                <div class="total-price-sum  total_price total_price_box total_price_box_full">
                    $54<sup>.00</sup>
                </div>
            </div>
        </div>
        <div id="box_category_of_writer" class="row">
            <div class="cell cell-left">
                <!--label for="" class="left-label">I want a specific writer to complete my order, if possible:</label -->
            </div>
            <div class="cell cell-right" id="box_defined_writer">
                <!--select id="request_writer" name="request_writer" disabled="disabled">
                   <option selected="selected" value="">First enter your email</option>
                   </select -->

                <label for="defined_writer" class="no-padding"
                       data-finder="form.label.definedwriter2"></label>
                Preferred Writer?
                <small id="preffered_status"></small>
                <input type="text" onchange="return setPreferred();" placeholder="Writer ID" name="writer_id" class="">
                </select>
                to&nbsp;complete my order, if possible.
            </div>
        </div>
        <div class="box_customer_discounts row">
            <div class="cell cell-left">
                <label for="" class="left-label">Discounts:</label>
            </div>
            <div class="cell cell-right">
                <div class="radios customer_discounts">
                    <input type="hidden" name="discounted">
                    <div id="pricediv">
                        <small id="responsi" style="color:red;"></small><input onchange="useCode();" placeholder="Promotion Code" id="promotion" type="text" class="form-control" style="" name="promotion"><a style="color:white;font-weight:bolder;" onclick="return useCode();" class="label label-success"><span class="glyphicon glyphicon-ok"></span> Use Code</a>
                    </div>
                </div>
            </div>
        </div>
            <input type="hidden" name="partial" value="0">
        @else
            <input type="hidden" name="partial" value="1">
            <input type="hidden" name="discounted">
            <div class="cell cell-right" id="box_defined_writer">
                <!--select id="request_writer" name="request_writer" disabled="disabled">
                   <option selected="selected" value="">First enter your email</option>
                   </select -->

                <label for="defined_writer" class="no-padding"
                       data-finder="form.label.definedwriter2"></label>
                Preferred Writer?
                <small id="preffered_status"></small>
                <input type="text" onchange="return setPreferred();" placeholder="Writer ID" name="writer_id" class="">
                </select>
                to&nbsp;complete my order, if possible.
            </div>

            <div class="alert alert-info" id="box_defined_writer">
                <span style="font-size:large;font-weight:bolder;" class="">Deposit Amount:  <span id="" class="total-price-sum total_price total_price_box deposit_amt"></span></span>
                <p>
                    The copy of your completed paper will be sent to you, after which the remaining <strong>{{ 100-$website->deposit }}%</strong> will be paid.
                </p>
            </div>

        @endif
        @if(!Auth::user())
        <div class="ui-tabs ui-widget ui-widget-content ui-corner-all"
             id="tabs_customer_type">
            <ul role="tablist"
                class="cabinet-tabs orderform-inside-tabs ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
                <li id="new_customer_tab" aria-selected="true" aria-labelledby="tabs_1" aria-controls="tabs-1"
                    tabindex="0" role="tab"
                    class="cabinet-tab ui-state-default ui-corner-top ui-tabs-active ui-state-active">
                    <a onclick="return showNewCustomer();" tabindex="-1" role="presentation" id="tabs_1"
                       class="cabinet-tab-link orderform-inside-tab-link ui-tabs-anchor"
                       href="#tabs-1" data-finder="form.link.tabcustomer1">New
                        customer</a>
                </li>
                <li id="returning_customer_tab" aria-selected="false" aria-labelledby="tabs_2"
                    aria-controls="tabs-2" tabindex="-1" role="tab"
                    class="cabinet-tab ui-state-default ui-corner-top">
                    <a tabindex="-1" onclick="return showReturningCustomer();"
                       role="presentation"
                       id="tabs_2"
                       class="cabinet-tab-link orderform-inside-tab-link ui-tabs-anchor"
                       href="#tabs-2">Returning customer</a>
                </li>
            </ul>
            <!-- New User tab -->
            <div aria-hidden="false" aria-expanded="true" role="tabpanel"
                 aria-labelledby="tabs_1" id="tabs-1"
                 class="orderform-auth-container ui-tabs-panel ui-widget-content ui-corner-bottom">
                <!-- User email -->
                {{ csrf_field() }}
                <div id="box_email" class="row">
                    <div class="cell cell-left">
                        <label for="" class="left-label">E-mail:</label>
                    </div>
                    <div class="cell cell-right">
                        <input name="email" maxlength="100" id="email"
                               class="validate[required,custom[email],funcCall[isDuplicatedEmail]] f_sz_220"
                               data-validation-class="validate[required,custom[email],funcCall[isDuplicatedEmail]]"
                               data-finder="form.input.email" type="text">
                          <div id="email_error" class="error" style=""></div>  

                    </div>
                </div>
                <!-- User password -->
                <div id="box_password" class="row">
                    <div class="cell cell-left">
                        <label for="" class="left-label">Create password:</label>
                    </div>
                    <div class="cell cell-right">
                        <input name="password" id="password"
                               class="f_sz_220 validate[required,custom[passwordrequired],custom[noSpecialCaracters],custom[minPasswordSize]]"
                               maxlength="30" value="" data-finder="form.input.password"
                               type="password">
                                <div id="password_error" class="error" style=""></div>  
                    </div>
                </div>
                <!-- Password confirmation if needed -->
                <div id="box_confirm_password" class="row">
                    <div class="cell cell-left">
                        <label for="" class="left-label">Confirm password:</label>
                    </div>
                    <div class="cell cell-right">
                        <input name="password_confirmation" id="confirm_password"
                               class="f_sz_220 validate[required,equals[password]]"
                               data-validation-class="validate[required,equals[password]]"
                               maxlength="30" value=""
                               data-finder="form.input.confirmpassword" type="password">
                    </div>
                </div>
                <!-- User name if needed -->
                <div id="box_fname" class="row">
                    <div class="cell cell-left">
                        <label for="" class="left-label">Name:</label>
                    </div>
                    <div class="cell cell-right">
                        <input name="name" id="fname" maxlength="100"
                               class="f_sz_220 validate[required,custom[namerequired]]"
                               data-validation-class="validate[required,custom[namerequired]]"
                               data-finder="form.input.fname" type="text">
                                <div id="name_error" class="error" style=""></div>  
                    </div>
                </div>
                <input type="hidden" name="user_id" value="{{ @Auth::user()->id or '' }}">
                <div id="box_fname" class="row">
                    <div class="cell cell-left">
                        <label for="" class="left-label">Phone:</label>
                    </div>
                    <div class="cell cell-right">
                        <div class="col-md-5">

                            <select name="country">

                                @foreach($countryCallingCodes as $key=>$val)
                                    <?php
                                        $key = str_replace('-','',$key);
                                        $key = str_replace('+','',$key);
                                    similar_text($country,$val,$percent);
                                        $more = 90;
                                        if($percent > $more)
                                            $more=$percent

                                    ?>
                                    <option {{ $more>90 ? 'selected':''  }} value="{{ $val.'(+'.$key.')' }}">{{ $val.'(+'.$key.')' }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="col-md-6">
                            <input name="phone" value="" class="form-control" type="text" class="input-large" required="">
                            <div id="phone_error" class="error" style=""></div>
                        </div>
                    </div>
                </div>
                <input type="hidden" name="referred_by" value="{{ @$_GET['referred_by'] }}">
                  <div id="box_fname" class="row">
                    <div class="cell cell-left">
                        <label for="" class="left-label">&nbsp;</label>
                    </div>
                    <div class="cell cell-right">
                         <input onclick="return registerUser();" aria-disabled="false" role="button"
                                 class="ui-button ui-widget ui-state-default ui-corner-all customer_login"
                                            id="customer_login" name="user_register"
                                 value="Register"
                                 type="button">
                        <i style="display: none;" class="fa-li fa fa-spinner fa-spin fa-2x"></i>
                    </div>
                </div>
                <!-- Customer country -->
                <!-- Customer contact phone -->
            </div>
            <!-- Existing user tab -->
            <div aria-hidden="true" aria-expanded="false" style="display: none;"
                 role="tabpanel" aria-labelledby="tabs_2" id="tabs-2"
                 class="orderform-auth-container ui-tabs-panel ui-widget-content ui-corner-bottom">                 
                <div id="box_logged_email" class="row">
                    <div class="cell cell-left">
                        <label for="" class="left-label">Email or Username:</label>
                    </div>
                    <div class="cell cell-right">
                        <input name="old_email" maxlength="100" id="email"
                               class="validate[required,custom[email]] f_sz_220"
                               data-validation-class="validate[required,custom[email]]"
                               data-finder="form.input.oldemail" type="text">
                      <div id="email_error_login" style="display:none;" class="error">Invalid username or password</div>
                    </div>
                    <div class="clearboth"></div>
                </div>
                <!-- User password -->
                <div id="box_old_password" class="row">
                    <div class="cell cell-left">
                        <label for="" class="left-label">Password:</label>
                    </div>
                    <div class="cell cell-right">
                        <input name="old_password" id="password"
                               class="f_sz_220 validate[required,custom[passwordrequired],custom[noSpecialCaracters]]"
                               value="" data-finder="form.input.oldpassword"
                               type="password">
                        <em id="password_ok" class="validation_img hidden">
                            &nbsp;</em>
                        <em id="password_err" class="validation_img hidden">
                            &nbsp;</em>
                        <div class="wrap-fp">
                  <span class="fp-step3 manage">
                  <em class="forIE"><em class="forIE2">
                          <input onclick="return loginUser();" aria-disabled="false" role="button"
                                 class="ui-button ui-widget ui-state-default ui-corner-all"
                                 id="customer_login" name="customer_login"
                                 value="Sign in"
                                 type="button">                        <i style="display: none;" class="fa fa-spinner fa-spin fa-2x"></i>

                      </em></em>
                  </span>
                            <div class="input-model"><a target="_blank" 
                                        href="{{ URL::to('forgot/password') }}"
                                        class="forgot-password-link">Forgot your
                                    password?</a>
                            </div>
                        </div>
                    </div>
                    <div class="clearboth"></div>
                </div>
                <!-- Customer country -->
            </div>
        </div>
        @else
        @endif
       <div id="box_payment_system" class="row box_payment_system_logged ui-buttonset">
            <div class="cell cell-left with-mobile-tip">
                <label for="" class="left-label">Payment system:</label>
                <div data-hasqtip="33" class="mobile-tip"></div>
            </div>
            <div aria-describedby="qtip-32" data-hasqtip="32" class="cell cell-right side_tip side_tip_payment_system">
                <div class="visible-in-mobile">
                    <select name="payment_method" class="form-control">
                        <option value="paypal">Paypal</option>
                        {{--<option value="payza">Payza</option>--}}
                        <option value="balance">Balance/Loyalty Points</option>
                    </select>
                </div>
                <div class="visible-in-desktop">
                    <input id="payment_method_paypal" type="radio" title="asd" value=""
                           name="academiclevel" class="ui-helper-hidden-accessible"
                           checked="checked">
                    <label style="height:65px;padding-top: 10px;font-weight:500;font-size: medium;" id="payment_label_paypal" onclick="setPaymentMethod('paypal');" for="academic_input_56" data-hasqtip="0"
                           class="payment_lbl ui-button ui-widget ui-button-text-only ui-state-active"
                           role="button" aria-disabled="false" aria-pressed="true">
                        <strong><img style="max-width:105px;padding-top:-5px;" src="{{ URL::to("img/paypal.jpg") }}"></strong>
                    </label>
                    {{--<input id="payment_method_payza" type="radio" title="asd" value=""--}}
                           {{--name="academiclevel" class="ui-helper-hidden-accessible"--}}
                           {{--checked="checked">--}}
                    {{--<label style="height:65px;padding-top: 10px;font-weight:500;font-size: medium;" id="payment_label_payza" onclick="setPaymentMethod('payza');" for="academic_input_56" data-hasqtip="0"--}}
                           {{--class="payment_lbl ui-button ui-widget ui-button-text-only"--}}
                           {{--role="button" aria-disabled="false" aria-pressed="true">--}}
                        {{--<strong><img style="max-width:105px;padding-top:-5px;" src="{{ URL::to("img/payza.jpg") }}"></strong>--}}
                    {{--</label>--}}
                    <input id="payment_method_balance" type="radio" title="asd" value=""
                           name="asdfgh" class="ui-helper-hidden-accessible"
                           checked="checked">
                    <label style="height:65px;padding-top: 10px;font-weight:500;font-size: medium;" id="payment_label_balance" onclick="setPaymentMethod('balance');" for="academic_input_55" data-hasqtip="0"
                           class="ui-button payment_lbl ui-widget ui-state-default ui-button-text-only"
                           role="button" aria-disabled="false" aria-pressed="true">
                        <strong>Balance/Loyalty Points</strong>
                    </label>
                </div>
            </div>
        </div>
        <input onclick="return payNow();" {{ Auth::user() ? '':'disabled' }} class="orderform-submit button highlight large to_billing_btn proceed_checkoutt"
               value="Proceed to safe payment →"
               type="submit">

        <input type="hidden" name="pay_now" value="1">
        <div id="box_payment_system" class="row box_payment_system_logged ui-buttonset">
            <div class="orderform-buttons f_submit_box f_submit_box_logged">
                <input style="height: 25px; padding:2px !important;" onclick="return payLater();" {{ Auth::user() ? '':'disabled' }} class="orderform-submit btn-sm btn-link button highlight large to_billing_btn"
                       value="Pay Later"
                       type="submit">
                <img src="files/ajax-loader-circle.gif" alt=""
                     class="to_billing_processing hidden" height="24" width="24">
                <a onclick="return stepTwo();" href="javascript:void(0)"
                   class="orderform-prev input-model large order_form_repeat_step2"
                   data-finder="form.link.backtostep2">← Previous step</a>
            </div>
            <i id="loading_submit" style="display: none;" class="fa fa-spinner fa-spin fa-4x pull-right"></i>
    </fieldset>

</div>
<script type="text/javascript">
//    var telInput = $("input[name='phone']");
//    telInput.intlTelInput("loadUtils", "lib/libphonenumber/build/utils.js");
//    telInput.intlTelInput();
//    telInput.change(function(){
//        checkValid();
//    });
$(".orderform-bordered").submit(function(){
    $(".to_billing_btn").prop('disabled','disabled');
    $("#loading_submit").slideDown();
});
function payLater(){
    $("input[name='pay_now']").val(0);
}

function payNow(){
    $("input[name='pay_now']").val(1);
}
    function setCountry(){
        var countryData = $("input[name='phone']").intlTelInput("getSelectedCountryData");
        var country = countryData.name+"(+"+countryData.dialCode+")";
        $("input[name='country']").val(country);
    }
    $("#reg_form").submit(function(){
        checkValid();
    });
    function checkValid(){
        setCountry();
        //       var phone = $("input[name='phone']").val();
        //        if(isNaN(phone) && phone.length<15 && phone.length>6){
        //            isValid = true;
        //        }else{
        //            isValid = false;
        //        }
        //
        //        if(isValid){
        //            console.log('valid');
        //            $("#phone_group").removeClass('has-error');
        //        }else{
        //            $("#phone_group").addClass('has-error');
        //            console.log('invalid');
        //        }
        //        return isValid;
    }

    function registerUser(){
        $(".customer_login").prop('disabled','disabled');
        $(".fa-spinner").show();
        $("#loading_submit").hide();
        var data = $('#tabs-1 :input').serialize();
        var url = '{{ URL::to('users/register') }}';
        $.post(url,data,function(response){
            $(".customer_login").removeAttr('disabled');
            $(".fa-spinner").hide();
            if(typeof response =='object'){
                var result = response;
            }else{
                var result = JSON.parse(response);
            }

            if(result.id==undefined){
                for(var key in result){
                    $("#"+key+"_error").html(''+result[key][0]+'</li>');
                }
                setTimeout(function() {
                  $(".error").html('');
                }, 2000);
            }else{
                $(".orderform-submit").removeAttr('disabled');
              $("input[name='user_id']").val(result.id);
                        $("#tabs_customer_type").html('<h3>Welcome <strong>'+result.name+'!</strong>,<br/>Please proceed to checkout.</h3>');
               var password = $("input[name='password']").val();
               var email = $("input[name='email']").val();
               var token = '{{ csrf_token() }}';
              var data = {email:email,password:password,_token:token};
              console.log(data);
             var url = '{{ URL::to('user/login') }}';
                 $.post(url,data ,function(response){

                 });
               }
        });

        return false;
    }
    function loginUser(){
        $(".fa-spinner").show();
        $("#loading_submit").hide();
      $("#email_error_login").slideUp();
      var password = $("input[name='old_password']").val();
      var email = $("input[name='old_email']").val();
      var token = '{{ csrf_token() }}';
      var data = {email:email,password:password,_token:token};
      console.log(data);
      var url = '{{ URL::to('users/login') }}';
      $.post(url,data ,function(response){
          $(".fa-spinner").hide();        
        if(typeof  response =='object'){
        var result = response;
        }else{
         var result = JSON.parse(response);   
        }
        if(result.status==false){
          $("#email_error_login").slideDown();
          $("#email_error_login").html(result.error);
        }else{
            $(".orderform-submit").removeAttr('disabled');
           $("input[name='user_id']").val(result.id);
          $("#tabs_customer_type").html('<h3>Welcome back <strong>'+result.name+'!</strong>,<br/>Please proceed to checkout.</h3>');
        }
      });
      return false;
    }
</script>
<script type="text/javascript">
    checkLogin();
    function checkLogin(){
        @if(!Auth::user())
    $("#register_login").modal({
            backdrop: 'static',
            keyboard: true
        });
        return false;
        @endif
   }


    function useCode(){
        getOrderCost();
        $("#responsi").html('Processing...');
        var code = $("#promotion").val();
        var url = "{{ URL::to('promotions/search') }}";
        var total = $("input[name='total_price']").val();
        $.get(url,{code:code,total:total},function(data){
            var response = JSON.parse(data);
            $("#responsi").html('processing.. ');
            if(response.status){
                $("#responsi").html('');
                var total = parseInt($("input[name='total_price']").val());
                $("input[name='discounted']").val(response.percent);
                var dis = 100-parseInt(response.percent);
                var newtot = dis/100*total;
                $("#final_total").val(newtot);
                $(".total_price_box").html('$'+newtot.toFixed(2));
                $("#pricediv").html('<strong>Total Cost</strong></td><td colspan="3" style="color:green;font-size:large;">Success! You have been awarded  <span style="color:red;">'+response.percent+'%</span> promotion on your order total.New cost is <span style="color:red;">$'+newtot.toFixed(2)+'</span> from <span style="color:red;">$'+total+'</span>')

            }else{
                $("#responsi").html(response.error);
            }
        });
    }

    function goBack() {
        window.history.back();
    }

    function setPreferred(){
        $("#preffered_status").html('<span style="color:green;">Processing...</span>');
        var id = $("input[name='writer_id']").val();
        var data = {writer_id:id};
        var url = '{{ URL::to('stud/preferred_writer') }}';
        $.get(url,data,function(response){
            if(response=='true'){
                $("#preffered_status").html('<span style="color:green;">Writer Found<i class="fa fa-check"></i></span>');
            }else{
                $("#preffered_status").html('<span style="color:red;">Writer not found!<i class="fa fa-times"></i></span>');
                $("input[name='writer_id']").val('');
            }
        });
    }
</script>
<style type="text/css">
    form-box-pay #ps_ingenico_btn:after {
        position: relative;
        display: block;
        float: left;
        margin: 0 5px;
        height: 16px;
        background: transparent {{ URL::to('/img/cabinet_spr.png') }} 999px 999px no-repeat !important;
        content: " ";
        text-indent: 0;
    }
</style>